<!DOCTYPE html>
<html>
<head>
  <title>Sign Up | NoteHub</title>

  <link href="../test-styling.css" rel="stylesheet">
  <link href="../logo.png" rel="icon">

  <style>
    #Page-Organiser-Mobile {
      padding: 7.5px;
    }
    
    @media screen and (max-width: 540px) {
      #Page-SignUpBox {
        width: calc(90% - 40px);
        margin-top: 80px; margin-left: 5%; margin-right: 5%;
      }
    }
    
    @media screen and (min-width: 541px) {
      #Page-SignUpBox {
        width: calc(50% - 40px);
        margin-top: 80px; margin-left: 25%; margin-right: 25%;
      }
    }
    
    #Page-SignUpBox {
      box-shadow: 4px 4px 20px 0px #888888;
      padding: 20px;
    }
    
    /*Add to the master stylesheet when possible*/
    #Page-Contents {
      /*Theodore, what is this?*/
    }
  </style>
  
  <script>
    var username, email, password, question;
    var savedStage = {
      username: "", email: "", password: "", question: ""
    };
    
    function Autorun() {
      username = document.getElementById("Login-Username"), email = document.getElementById("Login-Email"), password = document.getElementById("Login-Password"), question = document.getElementById("Login-Question");
    }
    
    function StageOne() {
      savedStage.username = username.value;
      savedStage.email = email.value;
      savedStage.password = password.value;
      savedStage.question = question.value;
      
      if ((savedStage.question == "") || (savedStage.email == "") || (savedStage.password == "") || (savedStage.username == "")) {
        document.getElementById("Error-Empty").style.display = "block";
      }
      else {
        document.getElementById("Error-Empty").style.display = "none";
        
        //Send request to server and make rainbows
        var getPHPFile = new XMLHttpRequest();
        getPHPFile.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            console.log(getPHPFile.responseText);
            document.getElementById("Error-Server").style.display = "none";
            
            if (getPHPFile.responseText == "Created.") {
              localStorage.setItem("logInStatus", "Newcomer!");
              localStorage.setItem("loggedIn", btoa(savedStage.username + "," + savedStage.password));
              //window.location.href = "my-account.html";
            }
            else { document.getElementById("Error-Username").style.display = "block"; }
          }
        };
        
        getPHPFile.onerror = function() {
          document.getElementById("Error-Server").style.display = "block";
        };
        
        getPHPFile.open("POST", "https://notehub-serverside.000webhostapp.com/handlers/account-data.php", true);
        getPHPFile.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        getPHPFile.send("requestedFunction=NewAccount&user=" + savedStage.username + "&pass=" + savedStage.password + "&email" + savedStage.email + "&securityQuestion" + encodeURIComponent(savedStage.question));
      }
    }
  </script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="Description" content="Welcome to NoteHub, the free notesharing service.">
</head>

<body onload="Autorun();">
  <div id="Page-TitleBar"><span style="float: left; margin: 10px"><img src="../logo.png" height="50px" width="50px"></span><span style="font-weight: lighter;">Note</span><b>Hub</b></div>
  
  <div id="Page-SignUpBox">
    <span style="font-size: 25px">Sign Up</span>
    <br><br>
    Username:<br>
    <input id="Login-Username" data-stacked="stacked" placeholder="Username" />
    <br><br>

    Email:<br>
    <input id="Login-Email" data-stacked="stacked" placeholder="Email (this'll be kept private)" />
    <br><br>

    Password:<br>
    <input id="Login-Password" type="password" data-stacked="stacked" placeholder="Password" />
    <br><br>

    Security Question:<br>
    <textarea rows="6" id="Login-Question" data-stacked="stacked" placeholder="You'll use this to verify your identity should you forget your password. Don't use a question with an obvious answer such as 'What is your username?'"></textarea>
    <br><br>
    
    <div id="Error-Empty" style="font-size: 0.85em; color: red; display: none;">
      We can't create your account as you're missing some personal information. Please fill in all the personal information required above.
      <br><br>
    </div>
    <div id="Error-Server" style="font-size: 0.85em; color: red; display: none;">
      We can't create your account for our servers are down. We'll fix this as soon as we can, and apologise for any inconvenience caused.
      <br><br>
    </div>
    <div id="Error-Username" style="font-size: 0.85em; color: red; display: none;">
      We can't create your account - your username's already taken. Why not try a different one?
      <br><br>
    </div>

    <button onclick="StageOne();" type="button" style="font-weight: bold; width: 100%; text-align: center; background-color: lightgreen; padding: 10px; border: 0;">SIGN UP</button>
  </div>
</body>
</html>
