<!DOCTYPE html>
<html>
<head>
  <title>Sign Up | NoteHub</title>

  <link href="/test-styling.css" rel="stylesheet">
  <link href="/logo.png" rel="icon">

  <style>
    #Page-Organiser-Mobile {
      padding: 7.5px;
    }
    
    @media screen and (max-width: 540px) {
      #Page-Organiser-Mobile { display: block; }
      #Page-Organiser-Desktop { display: none; }
    }
    
    @media screen and (min-width: 541px) {
      #Page-Organiser-Desktop { display: block; }
      #Page-Organiser-Mobile { display: none; }
    }
    
    .Page-Right-Step {
      border-radius: 10px;
      padding: 10px; margin-bottom: 10px;
    }
    
    #Page-SignUpBoxDesktop {
      width: calc(50% - 40px);
      margin-top: 80px; margin-left: 25%; margin-right: 25%;
      box-shadow: 8px 8px 25px 5px #888888;
      padding: 20px;
    }
    
    #Page-SignUpBoxMobile {
      width: calc(90% - 20px);
      margin-top: 80px; margin-left: 5%; margin-right: 5%;
      box-shadow: 8px 8px 25px 5px #888888;
      padding: 20px;
    }
    
    /*Add to the master stylesheet when possible*/
    #Page-Contents { }
    
    input[data-stacked=stacked] {
      padding: 7.5px;
      width: calc(100% - 15px);
      border: 0;
      background-color: #f6f6f6;
      margin-top: 5px;
    }
    
    textarea {
      font-family: "Segoe UI", sans-serif;
    }
    
    textarea[data-stacked=stacked] {
      padding: 7.5px;
      width: calc(100% - 15px);
      border: 0;
      background-color: #f6f6f6;
      margin-top: 5px;
    }
    
    button { cursor: pointer; }
  </style>
  
  <script>
    var username, email, password, question;
    var savedStage = {
      username: "", email: "", password: "", question: ""
    };
    
    function Autorun() {
      username = document.getElementById("Login-Username"), email = document.getElementById("Login-Email"), password = document.getElementById("Login-Password"), question = document.getElementById("Login-Question");
    }

    function StageOne() {
      savedStage.username = username.value;
      savedStage.email = email.value;
      savedStage.password = password.value;
      savedStage.question = question.value;
      
      //Send request to server and make rainbows
      var getPHPFile = new XMLHttpRequest();
      getPHPFile.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          console.log(getPHPFile.responseText);

          if (getPHPFile.responseText == "Created.") {
            localStorage.setItem("logInStatus", "Newcomer!");
            localStorage.setItem("loggedIn", btoa(savedStage.username + "," + savedStage.password));
            
            window.location.href = "my-account.html";
          }
          else {
            //Display errors if email is alr used/username is alr used
            localStorage.setItem("logInStatus", "Incorrect credentials.");
          }
        }
        else {
          localStorage.setItem("logInStatus", "Could not connect to server.");
        }
      }

      getPHPFile.open("GET", "https://notehub-serverside.000webhostapp.com/handlers/account-data.php?" + "requestedFunction=NewAccount&user=" + savedStage.username + "&pass=" + savedStage.password + "&email" + savedStage.email + "&securityQuestion" + savedStage.question, true);
      getPHPFile.send();
    }
  </script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="Description" content="Welcome to NoteHub, the free notesharing service.">
</head>

<body onload="Autorun();">
  <div id="Page-TitleBar"><span style="float: left; margin: 10px"><img src="/logo.png" height="50px" width="50px"></span><span style="font-weight: lighter;">Note</span><b>Hub</b> - Sign Up</div>

  <div id="Page-Organiser-Mobile">
    <div id="Page-SignUpBoxMobile">
      Username:<br>
      <input id="Login-Username" data-stacked="stacked" placeholder="Username" />
      <br><br>
      
      Email:<br>
      <input id="Login-Email" data-stacked="stacked" placeholder="Email (this'll be kept private)" />
      <br><br>
      
      Password:<br>
      <input id="Login-Password" type="password" data-stacked="stacked" placeholder="Password" />
      <br><br>
      
      Security Question:<br>
      <textarea rows="6" id="Login-Question" data-stacked="stacked" placeholder="You'll use this to verify your identity should you forget your password. Don't use a question with an obvious answer such as 'What is your username?'"></textarea>
      <br><br>
      
      <button onclick="StageOne();" type="button" style="font-weight: bold; width: 100%; text-align: center; background-color: lightgreen; padding: 10px; border: 0;">SIGN UP</button>
    </div>
  </div>
  
  <div id="Page-Organiser-Desktop">
    <div id="Page-SignUpBoxDesktop">
      Username:<br>
      <input id="Login-Username" data-stacked="stacked" placeholder="Username" />
      <br><br>
      
      Email:<br>
      <input id="Login-Email" data-stacked="stacked" placeholder="Email (this'll be kept private)" />
      <br><br>
      
      Password:<br>
      <input id="Login-Password" type="password" data-stacked="stacked" placeholder="Password" />
      <br><br>
      
      Security Question:<br>
      <textarea rows="6" id="Login-Question" data-stacked="stacked" placeholder="You'll use this to verify your identity should you forget your password. Don't use a question with an obvious answer such as 'What is your username?'"></textarea>
      <br><br>
      
      <button onclick="StageOne();" type="button" style="font-weight: bold; width: 100%; text-align: center; background-color: lightgreen; padding: 10px; border: 0;">SIGN UP</button>
    </div>
  </div>
</body>
</html>
